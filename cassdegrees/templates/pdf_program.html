{% extends "pdf_base.html" %}
{% load course_boxes %}
{% load math %}

{% block page-title %}{{ program.name }} ({{ program.year }}){% endblock %}

{% block content %}
    <div class="box" style="float: right">
        Student name & ID number: <br />
        <br />
    </div>

    <h1 class="no-bottom-margin">{{ program.name }} ({{ program.year }}, {{ program.units }} units)</h1>

    <br />

    <div class="columns-3 columns-no-gap">

        {% for rule in program.rules %}
            <div class="box">
                {% if rule.type == "subplan" %}
                    <p>Completion of {{ rule.kind }} for {{ rule.units }} units:</p>
                {% elif rule.type == "subject_area" %}
                    {# https://stackoverflow.com/questions/4831306/need-to-convert-a-string-to-int-in-a-django-template #}
                    {# add:"0" needed to cast units to int #}
                    <p>Complete {{ rule.unit_count }} units from {% if rule.unit_count|add:"0" <= 6 %}a{% endif %}
                        {{ rule.subject }} course{% if rule.unit_count|add:"0" > 6 %}s{% endif %}:</p>
                {% elif rule.type == "year_level" %}
                    <p>Complete {{ rule.unit_count }} units from {% if rule.unit_count|add:"0" <= 6 %}a{% endif %}
                        {{ rule.year_level }}-level course{% if rule.unit_count|add:"0" > 6 %}s{% endif %}:</p>
                {% elif rule.type == "course" %}
                    {# Find out if all courses are required #}
                    {% with courses_provided=rule.codes|length %}
                        {% with courses_needed=rule.unit_count|divide:6 %}
                            {% if courses_provided == courses_needed %}
                                {# All courses specified are required - render all #}
                                <p>Complete {{ rule.unit_count }} units from the following
                                    {% if rule.unit_count|add:"0" <= 6 %}course{% else %}set of courses{% endif %}:</p>
                            {% else %}
                                {# Not all required courses - give descriptions #}
                                <p>Complete {{ rule.unit_count }} units from a selection of:</p>
                                {% for code in rule.codes %}
                                    {{ code }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% endwith %}
                    {% endwith %}

                {% elif rule.type == "custom_text" %}
                    <p>For {{ rule.units }} units:</p>
                    <p>{{ rule.text }}</p>
                {% else %}
                <!-- TODO: courseRequirementTemplate -->
                    ERROR: Unknown rule type "{{ rule.type }}"!
                {% endif %}
            </div>


            {% if rule.type == "subplan" %}
                {% course_box rule.units %}
            {% elif rule.type == "subject_area" %}
                {% course_box rule.unit_count %}
            {% elif rule.type == "year_level" %}
                {% course_box rule.unit_count %}
            {% elif rule.type == "course" %}
                {% with courses_provided=rule.codes|length %}
                    {% with courses_needed=rule.unit_count|divide:6 %}
                        {% if courses_provided == courses_needed %}
                            {# All courses specified are required - render all #}
                            {% course_box_with_values rule.unit_count rule.codes %}
                        {% else %}
                            {# Not all required courses - map them out as blanks #}
                            {% course_box rule.unit_count %}
                        {% endif %}
                    {% endwith %}
                {% endwith %}
            {% elif rule.type == "custom_text" %}
                {% if rule.show_course_boxes %}
                    {% course_box rule.units %}
                {% endif %}
            {% endif %}

            {% if forloop.last %}<div class="break-box"></div>{% endif %}
        {% endfor %}

        <div class="break-column"></div>

        <div class="box small-text">
            <p>
                Instructions for filling in:
            </p>

            {{ program.studentNotes | linebreaks }}
        </div>

        {% for rule in program.globalRequirements %}
            <div class="box {% if forloop.last %} break-column{% endif %}">
                {% if rule.type == "min" %}
                    <p>
                        {{rule.prettyList}} courses: <br/>
                        <u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u> units ({{ rule.unit_count }} <b>minimum</b>)
                    </p>
                {% elif rule.type == "max" %}
                    <p>
                        {{rule.prettyList}} courses: <br/>
                        <u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u> units ({{ rule.unit_count }} <b>maximum</b>)
                    </p>
                {% else %}
                    ERROR: Unknown global requirement type "{{ rule.type }}"!
                {% endif %}
            </div>
        {% endfor %}
    </div>
{% endblock %}
