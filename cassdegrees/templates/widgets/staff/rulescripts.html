{% load static %}

{% verbatim %}
<script type="text/x-template" id="incompatibilityRuleTemplate">
     <fieldset v-if="!redraw">

         <div v-if="courses.length != 0">
             <p class="form-group">
                 <label>Students must not have completed/be currently enrolled in the following courses:</label>
             </p>

             <div class="msg-error" v-if="non_unique_options">Options must be unique!</div>
            <div class="msg-error" v-if="is_blank">All options must be filled in!</div>

            <div v-for="(code, index) in details.incompatible_courses">
                <select v-model="details.incompatible_courses[index]" v-on:change="check_options" required>
                    <option v-for="course in courses" v-bind:value="{'code': course.code, 'name': course.name}">
                        {{ course.code }} {{ course.name }}
                    </option>
                </select>
                <input v-if="details.incompatible_courses.length > 1" type="button" v-on:click="remove_course(index)" class="btn-uni-grad btn-snall no-left-margin" value="Remove" />
            </div>

            <input type="button" v-on:click="add_course()" class="btn-uni-grad btn-snall no-left-margin" value="Add new option" />
         </div>
         <div v-else v-html="info_msg"></div>

    </fieldset>
</script>


<script type="text/x-template" id="programRuleTemplate">
    <fieldset v-if="!redraw">

        <div v-if="programs.length != 0">
            <p class="form-group">
                <label>Students must be studying the following program:</label>
            </p>

            <div class="msg-error" v-if="is_blank">All options must be filled in!</div>

            <div>
                <select v-model="details.program" v-on:change="check_options" required>
                    <option v-for="program in programs" v-bind:value="program">{{ program.code }} {{ program.name }}</option>
                </select>
            </div>
        </div>
        <div v-else v-html="info_msg"></div>

    </fieldset>
</script>

<script type="text/x-template" id="courseRequisiteTemplate">
    <fieldset v-if="!redraw">

        <div v-if="courses.length != 0">
            <div class="msg-error" v-if="non_unique_options">Options must be unique!</div>
            <div class="msg-error" v-if="is_blank">All options must be filled in!</div>

            <p>
                Students must have completed the following courses:
            </p>

            <div v-for="(code, index) in details.codes">
                <select v-model="details.codes[index]" v-on:change="check_options" required>
                    <option v-for="course in courses" v-bind:value="{'code': course.code, 'name': course.name}">
                        {{ course.code }} {{ course.name }}
                    </option>
                </select>
                <input v-if="details.codes.length > 1" type="button" v-on:click="remove_course(index)" class="btn-uni-grad btn-snall no-left-margin" value="Remove" />
            </div>

            <input type="button" v-on:click="add_course()" class="btn-uni-grad btn-snall no-left-margin" value="Add new option" />
        </div>
        <div v-else v-html="info_msg"></div>

    </fieldset>
</script>

<script type="text/x-template" id="electiveRuleTemplate">
    <fieldset v-if="!redraw">

        <div v-if="subject_areas.length != 0">
            <div class="msg-error" v-if="invalid_units">Unit count must be non-negative!</div>
            <div class="msg-error" v-if="invalid_units_step">Unit count should be divisible by 6!</div>
            <div class="msg-error" v-if="is_blank">All options must be filled in!</div>
            <p>
                Students must complete
                <input style="margin-left: 0;" class="text" v-on:change="update_units" onkeydown="javascript: return checkKeys(event)" type="number" min="0" step="6" max="1000" v-model="details.unit_count" aria-required="true" required>
                units from
                <select v-model="details.year_level" required>
                    <option value="all" selected>All</option>
                    <option v-for="year_level in number_of_year_levels" v-bind:value="year_level*1000">{{ year_level*1000 }}-level</option>
                </select>
                electives in
                <select v-model="details.subject_area" required>
                    <option value="all" selected>Any</option>
                    <option v-for="subject_area in subject_areas" v-bind:value="subject_area">{{ subject_area }}</option>
                </select>
                subject area.
            </p>
        </div>
        <div v-else v-html="info_msg"></div>

    </fieldset>
</script>

<script type="text/x-template" id="customTextRuleTemplate">
    <fieldset>
        <p>
            Students must complete the following:
        </p>

        <div class="msg-error" v-if="is_blank">All options must be filled in!</div>

        <p>
            <textarea v-model="details.text" v-on:change="check_options" style="width: 100%" placeholder="Enter some custom rules here..." aria-required="true" required></textarea>
        </p>

        <p class="form-group">
            <label>Unit value for this item:</label>
            <input class="text" v-on:change="update_units" onkeydown="javascript: return checkKeys(event)" type="number" min="0" max="1000" v-model="details.unit_count" aria-required="true" required>
        </p>

        <div class="msg-error" v-if="not_divisible">Units must be divisible by 6!</div>

        <p class="form-group">
            <label>Show 6-unit course boxes in plans (e.g. PDF):</label>
            <input class="text" type="checkbox" v-model="details.show_course_boxes">
        </p>
    </fieldset>
</script>

<script type="text/x-template" id="customTextReqRuleTemplate">
    <fieldset>
        <p>
            Students must meet the following requirements:
        </p>

        <div class="msg-error" v-if="is_blank">All options must be filled in!</div>

        <p>
            <textarea v-model="details.text" v-on:change="check_options" style="width: 100%" placeholder="Enter some custom rules here..." aria-required="true" required></textarea>
        </p>

    </fieldset>
</script>

<script type="text/x-template" id="ruleTemplate">
    <div class="card">
        <header class="box-header">
            <p class="card-header-title">
                {{ component_names[details.type] }}
            </p>
            <img src="//style.anu.edu.au/_anu/images/icons/web/question.png" class="btn-snall no-left-margin vertical-middle clickable"
                 alt="Help button" v-on:click="show_help = true" />
            <input type="button" v-on:click="$emit('remove')" class="btn-uni-grad btn-snall no-left-margin" value="Remove" />
            <input type="button" v-on:click="$emit('duplicate_rule')" class="btn-uni-grad btn-snall no-left-margin" value="Duplicate" />
        </header>
        <div class="box-solid">
            <div class="card-content" v-bind:refresh="refresh" v-bind:is="'rule_' + details.type" v-bind:details="details"></div>
        </div>

        <div class="modal" v-if="show_help">
            <div class="modal-background" v-on:click="show_help = false"></div>
            <div class="modal-card">
                <div class="card">
                    <header class="box-header">
                        Help for {{ component_names[details.type] }}
                    </header>
                    <div class="box-solid box-has-footer">
                        <p>{{ component_help[details.type] }}</p>
                    </div>
                    <footer class="box-solid">
                        <button class="button" v-on:click="show_help = false">OK</button>
                    </footer>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/x-template" id="course-list-template">
    <fieldset v-if="!redraw">

        <p class="form-group">
            <Label style="width: 20.8333%; text-align: right; float: left;">List name:</Label>
            <input class="text tfull" v-model="details.list_description"
                   placeholder="Optional description for CASS Staff Reference, e.g. CASS Majors"
                   style="margin-left: 0;">
        </p>

        <p class="form-group">
            <label style="width: 20.8333%; text-align: right; float: left;">List type:</label>
            <select v-model="details.list_type" v-on:change="updateListTypeLabel()" required>
                <option v-for="(msg, type) in list_types" v-bind:value="type">{{ type }}</option>
            </select>
        </p>

        <p class="form-group">
            <label style="width: 20.8333%; text-align: right; float: left;">Number of units:</label>
            <input style="margin-left: 0;" class="text" onkeydown="javascript: return checkKeys(event)" type="number"
                   v-on:change="updateUnitCountLabel()" v-model="details.unit_count" min="0" step="6" max="1000" required>
        </p>

        <br>

        <div class="msg-error" v-if="invalid_units">Unit count must be > 0!</div>
        <div class="msg-error" v-if="invalid_units_step">Unit count should be divisible by 6!</div>
        <div class="msg-error" v-if="non_unique_options">Options must be unique!</div>
        <div class="msg-error" v-if="is_blank">All options must be filled in!</div>

        <p>Students must select {{ list_type_label }} {{ unit_value_label }} units from the following courses:</p>

        <br>

        <multiselect
                :options="courses"
                :value="optionsProxy"
                @input="updateSelected"
                :show-labels="true"
                :multiple="true"
                :searchable="true"
                :close-on-select="false"
                :placeholder="placeholderText"
                :custom-label="customLabel"
                track-by="name"
                :max-height="200"
                :open-direction="'top'"
                :loading="showLoadingSpinner"
                ref="multiselectref"
                >
        </multiselect>

        <div class="msg-warn" v-if="is_list_search">Searching in list mode,
            <a href="javascript:void(0);" @click="toggleListMode()">return to course mode</a></div>

        <ul class="resources-list">
            <template v-for="(resource, index) in sortedSelectedList">
                <li class="resource-item" :data-index="index">
                    <div class="resource-info">
                        <div class="resource-title" :id="index">
                            <span>{{ resource.code }} - {{ resource.name }} </span>
                        </div>
                    </div>
                    <div class="delete-controls" v-on:click.prevent="removeDependency(index)">
                        <i class="fa fa-times fa-fw"></i>
                    </div>
                </li>
            </template>
        </ul>

        <input style="margin-left: 0; float: right;" class="btn-uni-grad btn-large" type="button"
               value="Add Courses from Existing List"
               v-on:click="toggleListMode()">
    </fieldset>
</script>

<script type="text/x-template" id="subplanRuleMultiselectTemplate">
    <fieldset v-if="!redraw">

        <div v-if="subplans.length != 0">
            <div class="msg-error" v-if="non_unique_options">Options must be unique!</div>
            <div class="msg-error" v-if="inconsistent_units">Options have different unit values!</div>
            <div class="msg-error" v-if="wrong_year_selected">Selected subplans must have same year as program!</div>
            <div class="msg-error" v-if="is_blank">All options must be filled in!</div>

            <p class="form-group">
                <Label style="width: 20.8333%; text-align: right; float: left;">List name:</Label>
                <input class="text tfull" v-model="details.list_description"
                   placeholder="Optional description for CASS Staff Reference, e.g. CASS Majors" style="margin-left: 0;">
            </p>

            <p class="form-group">
                <label style="width: 20.8333%; text-align: right; float: left;">Student description:</label>
                <input class="text tfull" v-model="details.kind" v-on:change="updateStudentDescriptionLabel()" aria-required="true"
                       placeholder="e.g. Arts Major - brief description for students here" style="margin-left: 0;">
            </p>

            <p class="form-group">
                <label style="width: 20.8333%; text-align: right; float: left;">Subplan type:</label>
                <select v-model="details.subplan_type" v-on:change="change_filter" required style="margin-left: 0;">
                    <option v-for="(msg, type) in subplan_types" v-bind:value="type">{{ msg }}</option>
                </select>
            </p>

            <br>

            <p>Students must pick one {{ student_description_label }} from the following {{ subplan_type_label }}:</p>

            <br>

            <multiselect
                    :options="sortedSubplanList"
                    :value="optionsProxy"
                    @input="updateSelected"
                    :show-labels="true"
                    :multiple="true"
                    :searchable="true"
                    :close-on-select="false"
                    :placeholder="placeholderText"
                    :custom-label="customLabel"
                    track-by="name"
                    :max-height="200"
                    :open-direction="'top'"
                    :loading="showLoadingSpinner"
                    ref="multiselectref"
            >
            </multiselect>

            <ul class="resources-list">
                <template v-for="(resource, index) in sortedSelectedList">
                    <li class="resource-item" :data-index="index">
                        <div class="resource-info">
                            <div class="resource-title" :id="index">
                                <span>{{ resource.code }} - {{ resource.name }} </span>
                            </div>
                        </div>
                        <div class="delete-controls" v-on:click.prevent="remove_subplan(index)">
                            <i class="fa fa-times fa-fw"></i>
                        </div>
                    </li>
                </template>
            </ul>
        </div>
        <div v-else v-html="info_msg"></div>

    </fieldset>
</script>
{% endverbatim %}
    <script src="{% static "js/vendor/vue.js" %}"></script>
    <script src="{% static "js/vendor/vue-multiselect.js" %}"></script>
    <script src="{% static "js/vendor/vue-resource.js" %}"></script>
    <link rel="stylesheet" href="{% static "css/vue-multiselect.css" %}">